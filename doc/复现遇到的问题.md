# FUSE 文件系统测试环境配置指南

## 环境要求

1. **操作系统建议**：
   - 优先使用 Linux 环境（推荐 Ubuntu 或 CentOS）
   - macOS 环境下部分测试工具可能不可用或表现不一致

2. **FUSE 版本**：
   - 强烈建议使用 FUSE3
   - 如当前环境为 FUSE2：
     * 推荐升级到 FUSE3
     * 如无法升级，可取消 `/etc/fuse.conf` 中 `user_allow_other` 的注释

3. **Rust 工具链**：
   - 必须使用 Rust nightly 版本
   - 建议指定具体日期版本以避免 API 不兼容问题（如 `nightly-2023-01-01`）

4. **磁盘空间**：
   - 确保至少有 20GB 可用空间

## 安装与配置

1. **依赖安装**：
   - 不同 Linux 发行版依赖安装方式不同，请参考对应发行版文档
   - 常见依赖包括：fuse、fuse-devel、libfuse 等

2. **Rust 依赖问题处理**：
   - 如遇依赖冲突或编译失败：
     * 尝试更新依赖
     * 执行 `cargo clean` 清理缓存

3. **测试工具准备**：
   - mdtest 测试工具位于 ior 工具包中
   - 确保 bench 目录下工具（filebench、fio、mdtest）的环境变量配置正确

## 已知问题与修复

1. **自动化脚本问题**：
   - 原 `make prefile` 命令与 Makefile 存在冲突
   - 已修复为使用 `make pre_file`

2. **mdtest 测试问题**：
   - 可完成 92% 的测试用例
   - 偶尔会出现全部通过但原因不明的情况

## 故障排查

1. **文件系统挂载失败**：
   - 常见原因：
     * FUSE 版本不兼容
     * 挂载点不存在
     * 权限不足
   - 检查方法：
     * 查看系统日志
     * 逐项检查配置

2. **权限问题**：
   - 确保挂载点目录有足够权限
   - 检查 SELinux/AppArmor 等安全策略设置
   - 为自动化测试脚本添加执行权限：`chmod +x <script_name>`

3. **系统资源限制**：
   - 磁盘空间检查：`df -h`
   - 文件句柄数限制检查：`ulimit -n`

## 平台差异说明

1. **Linux 发行版差异**：
   - 不同发行版（Ubuntu/CentOS 等）的依赖安装方式可能不同

2. **macOS 限制**：
   - 部分测试工具（fio、filebench、mdtest）可能不可用
   - 测试结果可能与 Linux 环境不一致
   - 建议优先在 Linux 环境下复现问题

## 最佳实践建议

1. 在执行测试前，确保：
   - 所有依赖已正确安装
   - 有足够的磁盘空间
   - 具备必要的权限

2. 遇到问题时：
   - 首先检查系统日志
   - 确认 FUSE 版本兼容性
   - 验证环境变量和路径配置

3. 对于 Rust 相关问题时：
   - 确认使用正确的 nightly 版本
   - 定期更新依赖
   - 必要时清理构建缓存

此文档最后更新于 2025 年 4 月，请根据实际环境调整配置。